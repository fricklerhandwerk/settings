#! /usr/bin/env nix-shell
#! nix-shell -i fish \
# -p fish \
# -p git \
# -p gpg \
# -p gitAndTools.gitRemoteGcrypt

# bootstrap by running this script from USB stick with GPG keys to encrypted
# repository with system configuration.

# NOTE: if I ever implement the idea to keep a copy of this repository on the
# secret storage, the following should just be part of the regular install
# script.

set current (dirname (readlink -f (status -f)))

gpg --import $current/gpg.asc --homedir (mktemp -d)

set temp (mktemp -d)
git clone gcrypt::https://github.com/fricklerhandwerk/nixos $temp

# push over ssh for future use
cd $temp
git remote set-url --push origin gcrypt::git@github.com:fricklerhandwerk/nixos

$temp/install

